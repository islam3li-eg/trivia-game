<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Firebase Auth Popup Test</title>
  <!-- Firebase SDKs: Must use compat versions -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
  <button id="login">Sign in with Google</button>
  <button id="logout">Logout</button>
  <pre id="log" style="white-space: pre-wrap;"></pre>

  <script>
    // 1) Firebase init
    const cfg = {
      apiKey: "AIzaSyAfaNPHL2m7n66VBADqMmkNnBxUE6ucRjY",
      authDomain: "trivia-elaslyeen.firebaseapp.com"
    };
    firebase.initializeApp(cfg);
    const auth = firebase.auth();

    // 2) Persist session locally
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    // 3) Logging helper
    function out(msg) {
      console.log(msg);
      document.getElementById('log').textContent += msg + "\n";
    }

    // 4) Show origin
    out("page origin → " + location.origin);

    // 5) Listen for auth state (fires on load if already signed in, or after popup)
    auth.onAuthStateChanged(user => {
      out("onAuthStateChanged → " + (user ? user.displayName : "null"));
    });

    // 6) Hook up buttons
    document.getElementById('login').onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(result => {
          out("signInWithPopup returned user → " + result.user.displayName);
        })
        .catch(err => {
          out("Popup error: " + err.code);
        });
    };

    document.getElementById('logout').onclick = () => {
      auth.signOut().then(() => out("signed out"));
    };
  </script>
</body>
</html>
